$(document).ready(function () {
    "use strict";
	

    var t = $(".bar-container").children(),
        e = $(".container_menu .fa-times");
    t.on("click", function () {
        $(".container_menu").css({display: "block"});
    }),
    e.on("click", function () {
        $(".container_menu").css({display: "none"});
    }),
    $(window).resize(function () {
        window.matchMedia("(orientation: portrait)").matches || $(".container_menu").css({display: "none"})
    });
	
	$(function(){

		$("img[data-src]").lazyload({
			effect: "fadeIn"
		});
    });
	$("img[data-src]").each(function(){
		$(this).wrap("<a href='"+$(this).attr("data-src")+"' target='_blank'></a>");
	});
           
    $("header #sections .section").mouseenter(function () {
        "true" !== $(this).attr("data-select") && $(this).children().css({color: "#F9C33E"})
    }),
    $("header #sections .section").mouseleave(function () {
        "true" !== $(this).attr("data-select") && $(this).children().css({color: "white"})
    }),
    $("#sections .section,#portrait_sections .section").click(function () {
        var t = $(this).children().attr("href");
        t && (document.location.href = t)
    }),
    $("#sections .section span,#portrait_sections .section span").click(function () {
        var t = $(this).attr("href");
        t && (document.location.href = t)
    });
    var n = 0,
        i = !1,
        a = 0,
        o = $(document).height() / 200;
    $(document).scrollTop(0),
    $("#fixed_header").css({display: "none"});
	var $load_bar = $(".load_bar");
	
    $(document).scroll(function () {
        var t = $(this).scrollTop();
        i ? n < t && (a = n, i =! 1) : t < n && (a = n, i =! 0),
        Math.abs(t - a) > o && t < a && $("#fixed_header").css({display: "block"}) && $load_bar.css({top:$("#fixed_header").height()});
        o < t - a && $("#fixed_header").css({display: "none"}) && $load_bar.css({top:0}),
        0 === $(this).scrollTop() && $("#fixed_header").css({display: "none"}) && $load_bar.css({top:0, width: 0}),
        n = t;
    });
	if(!$("div").is(".main_page")){
		var header_img = $(".header_image_container")[0].scrollHeight;
		var header_bottom = $(".border-bottom")[0].scrollHeight;
		var header = $("header")[0].scrollHeight;
		var articles = $(".articles")[0].scrollHeight;
		var call_to_action = $(".call_to_action")[0].scrollHeight;
		var top_header = header + header_img + header_bottom;

		$load_bar.width(($(document).scrollTop() - top_header) / articles * screen.width);

		$(document).scroll(function(){
			articles = $(".articles")[0].scrollHeight;	

			if($(document).scrollTop() <= (top_header + articles) && $(this).scrollTop() >= top_header){

			  var delta = (($(document).scrollTop() - top_header) / (articles - call_to_action));
			  $load_bar.width(delta * screen.width);
			}
		});
	}
	
    setTimeout(function () {
        $(document).scrollTop(0);
    }, 10),
    $(".href").click(function () {
        var t = $(this).attr("data-href");
        window.open(t);
    }),
    $(".button_download").click(function () {
        var t = $(this).attr("data-href");
        window.open(t);
    }),
    $.post("/PHP/DeleteCookie.php");
	
	$(".bar .fa-caret-right,.phone_content .fa-caret-right").click(function(){
	    
		var mass = ["none","block"];
		var isOpen = Number.parseInt($(this).attr("data-open"));
		$(this).siblings("ul").css({
			display:mass[1 - isOpen]
		});
		$(this).attr("data-open",1-isOpen);
	});
	
//----------------------Sly-----------------------------------------------------------
	function VisibleArrow($slider, obj, index){
		$slider.find(obj).eq(index - 1).css({visibility:"hidden"});
		$slider.find(obj).eq(index).css({visibility:"visible"});
		$slider.find(obj).eq(index + 1).css({visibility:"hidden"});
	}
	
	function Next($ul, max){
		var $slider = $ul.parent().parent();
		var step = $ul.children().width();
		var curOffset = Number.parseFloat($ul.attr("data-offset"));
		
		if(curOffset > -max){
			var index = Number.parseInt($slider.attr("data-index"));
			index++;
			$slider.attr("data-index", index);
				
			if(index === 1)
			{
				$slider.find(".prev").css({
					visibility: "visible"
				});
			}
			
			if(index === $slider.find(".frame_block").length - 1){
				$slider.find(".next").css({
					visibility: "hidden"
				});
			}
			
		
			curOffset -= step;
		    $ul.css("transform", "translateX("+curOffset+"px"+")");
			$ul.attr("data-offset", curOffset);
			
			VisibleArrow($slider, "img", index);
			VisibleArrow($slider, ".hint", index);
		}
	}
	function Prev($ul){
		var $slider = $ul.parent().parent();
		var step = $ul.children().width();
		var curOffset = Number.parseFloat($ul.attr("data-offset"));
		if(curOffset < 0){
			var index = Number.parseInt($slider.attr("data-index"));
			index--;
			$slider.attr("data-index", index);
			
			if(index === 0)
			{
				$slider.find(".prev").css({
					visibility: "hidden"
				});
			}
			
			if(index === $slider.find(".frame_block").length - 2){
				$slider.find(".next").css({
					visibility: "visible"
				});
			}
			
			curOffset += step;
			
		    $ul.css("transform", "translateX("+curOffset+"px"+")");
			$ul.attr("data-offset", curOffset);
			
			VisibleArrow($slider, "img", index);
			VisibleArrow($slider, ".hint", index);
		}
	}
	
	var $slider = $(".slider");
	$slider.bind("inview", function(){
		
		if(!$(this)[0].hasAttribute("data-visible")){
			$(this).attr("data-visible", "1");
			
			$(this).find("img").each(function(){
				var data_img = $(this).attr("data-img");
				$(this).attr("src", data_img);
				$(this).removeAttr("data-img");
				$(this).wrap("<a href='"+$(this).attr("src")+"' target='_blank'></a>");
			});
			
			var $frame = $(this).find(".frames");
			
			var max = -1;
			var max_hint = -1;
			var rel = -1;
			var frame_width =  $(this).width() - $(this).find(".prev").width() * 2;
			var ul_width = frame_width * $(this).find(".frame_block").length;
			$(this).find("ul").width(ul_width);
			$(this).find("ul").attr("data-offset", 0);
			
			$(".frame_block").each(function(){
				
				$(this).width(frame_width);
				var data_height = Number.parseFloat($(this).children("a").children().attr("data-height"));
				if(data_height > max ){
					
					var data_width = Number.parseFloat($(this).children("a").children().attr("data-width"));
					max = data_height;
					rel = data_height / data_width;
				}
				
				var hint_height = $(this).find(".hint").height();
				if(hint_height > max_hint)
					max_hint = hint_height;
			});
			
			var slider_height = frame_width * rel + max_hint; 
			$(this).height(slider_height);
			
			$(".frame_block").each(function(){
				var $img = $(this).children("a").children();
				var img_height = Number.parseFloat($img.attr("data-height"));
				var img_width = Number.parseFloat($img.attr("data-width"));
				var real_img_height = frame_width * img_height / img_width;
				
				var hint_top = (slider_height - (real_img_height + $(this).children(".hint").height())) / 2;
				
				$(this).children(".hint").css({
					top: hint_top + "px"
				});
				
				$(this).children("a").children().css({
					top: hint_top + "px"
				});
			});
			
			setTimeout(function(){
				$frame.css({
					opacity: 1
				});
				
				$frame.siblings(".greyScreen").animate({
					opacity: 0
				}, 300);
				
				setTimeout(function(){
					$frame.siblings(".greyScreen").css({
						display: "none"
					});
				},300);
			},0);
			
			
			var $curSlider = $(this);
			$(this).find(".next").click(function(){	
				Next($curSlider.find("ul").eq(0), ul_width - frame_width);
			});
			$(this).find(".prev").click(function(){
				Prev($curSlider.find("ul").eq(0));
			});
			
			var prevPos = -1;
			var isTouch = false;
			
			$(this).find(".frames")[0].addEventListener('touchstart', function(e) {
				
				prevPos = e.changedTouches[0].pageX;
			});
			
			$(this).find(".frames")[0].addEventListener("touchmove", function(e){
				e.preventDefault();
                e.stopPropagation();
				
				
				var curPos = e.changedTouches[0].pageX;
				var delta = curPos - prevPos;
				var maxDelta = 5;
				
				if(!isTouch && delta > maxDelta){//swiperight
					Prev($curSlider.find("ul").eq(0));
					isTouch = true;
				}else if(!isTouch && delta < -maxDelta){//swipeleft
					Next($curSlider.find("ul").eq(0), ul_width - frame_width * 1.3);
					isTouch = true;
				}
				
				prevPos = curPos;
			});
			
			$(this).find(".frames")[0].addEventListener('touchend', function(e) {
				
				prevPos = -1;
				isTouch = false;
			});
			
		}	
	});
	//----------------------Sly-----------------------------------------------------------
	
	function ShowHint(){
		var $obj = $(this);
        alert($obj.attr("title"));
	}
	
	 $("sup").mouseenter(function () {
		ShowHint(); 
    });
	
//	$("sup").addEventListener('touchstart', function() {
//				
//		ShowHint();		
//	});
});